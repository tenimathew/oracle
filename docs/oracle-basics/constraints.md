---
id: Section 12. Constraints
sidebar_position: 12
description: PRIMARY KEY, FOREIGN KEY, UNIQUE, CHECK
---

## PRIMARY KEY

A primary key is a column of a combination of columns in a table that uniquely identifies a row in the table.

The following are rules that make a column a primary key:

- A primary key column cannot contain a NULL value or an empty string.
- A primary key value must be unique within the entire table.
- A primary key value should not be changed over time.

According to these rules, the following are the recommendations for the primary keys:

- First, the primary key should be meaningless. Sometimes, you may want use meaningful data, which considers being unique, for the primary keys e.g., social security number (SSN), vehicle identification number (VIN), email, and phone number. However, you donâ€™t know when the email or phone number changes or is reused by another person. In such cases, it will create many data problems. In the database world, the artificial keys are known as surrogate keys which are as opposed to natural primary keys.
- Second, the primary keys should be compact. The primary keys typically are numeric because Oracle typically processes numbers faster than any other data types.
- It is considered a best practice have a primary key in every table though it is not mandatory in Oracle.

### Creating a primary key that consists of one column

```sql
CREATE TABLE purchase_orders (
    po_nr NUMBER PRIMARY KEY,
    vendor_id NUMBER NOT NULL,
    po_status NUMBER(1,0) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL
);
```

```sql
CREATE TABLE purchase_orders (
    po_nr NUMBER,
    vendor_id NUMBER NOT NULL,
    po_status NUMBER(1,0) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    CONSTRAINT pk_purchase_orders PRIMARY KEY(po_nr)
);
```

### Creating a primary key that consists of multiple columns

```sql
CREATE TABLE purchase_order_items (
    po_nr NUMBER NOT NULL,
    item_nr NUMBER NOT NULL,
    product_id NUMBER NOT NULL,
    quantity NUMBER NOT NULL,
    purchase_unit NUMBER NOT NULL,
    buy_price NUMBER (9,2) NOT NULL,
    delivery_date DATE,
    PRIMARY KEY (po_nr, item_nr)
);
```

In this example we did not use the `CONSTRAINT` clause to explicitly assign the `PRIMARY KEY` constraint a name. Therefore, Oracle implicitly assigned the primary key constraint a system-generated name such as `SYS_C0010617`.

### Adding a primary key to a table

```sql
CREATE TABLE vendors (
    vendor_id NUMBER,
    vendor_name VARCHAR2(255) NOT NULL,
    address VARCHAR2(255) NOT NULL
);

ALTER TABLE vendors
ADD CONSTRAINT pk_vendors PRIMARY KEY (vendor_id);
```

### Dropping an Oracle PRIMARY KEY constraint

```sql
ALTER TABLE vendors
DROP CONSTRAINT pk_vendors;
```

```sql
ALTER TABLE vendors
DROP PRIMARY KEY;
```

### Enable / Disable an Oracle PRIMARY KEY constraint

#### Disable

```sql
ALTER TABLE purchase_orders
DISABLE CONSTRAINT pk_purchase_orders;
```

```sql
ALTER TABLE purchase_orders
DISABLE PRIMARY KEY;
```

#### Enable

```sql
ALTER TABLE purchase_orders
ENABLE CONSTRAINT pk_purchase_orders;
```

```sql
ALTER TABLE purchase_orders
ENABLE PRIMARY KEY;
```

## Identity column

Oracle 12c introduced a new way that allows you to define an identity column for a table, which is similar to the `AUTO_INCREMENT` column in MySQL or `IDENTITY` column in SQL Server.

```sql
GENERATED [ ALWAYS | BY DEFAULT [ ON NULL ] ]
AS IDENTITY [ ( identity_options ) ]
```

![](img/2022-07-03-09-11-38.png)

- First, the `GENERATED` keyword is mandatory.

- Second, you can specify an option to generate identity values:
  - `GENERATED ALWAYS`: Oracle always generates a value for the identity column. Attempt to insert a value into the identity column will cause an error.
  - `GENERATED BY DEFAULT`: Oracle generates a value for the identity column if you provide no value. If you provide a value, Oracle will insert that value into the identity column. For this option, Oracle will issue an error if you insert a NULL value into the identity column.
  - `GENERATED BY DEFAULT ON NULL`: Oracle generates a value for the identity column if you provide a NULL value or no value at all.
- Third, you can have a number of options for the identity column.
  - `START WITH` initial_value controls the initial value to use for the identity column. The default initial value is 1.
  - `INCREMENT BY` internval_value defines the interval between generated values. By default, the interval value is 1.
  - `CACHE` defines a number of values that Oracle should generate beforehand to improve the performance. You use this option for the column that has a high number of inserts.

### GENERATED ALWAYS example

```sql
CREATE TABLE identity_demo (
    id NUMBER GENERATED ALWAYS AS IDENTITY,
    description VARCHAR2(100) NOT NULL
);

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo with GENERATED ALWAYS');
```

The following statement attempts to insert a value into the id identity column:

```sql
INSERT INTO identity_demo(id,description)
VALUES(2,
       'Oracle identity column example with GENERATED ALWAYS ');
```

Oracle issued an error:

```sql
SQL Error: ORA-32795: cannot insert into a generated always identity column
```

Because the id column was defined as `GENERATED ALWAYS`, it could not accept any provided value.

### GENERATED BY DEFAULT example

```sql
DROP TABLE identity_demo;

CREATE  TABLE identity_demo  (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    description VARCHAR2(100) not null
  );

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo with GENERATED BY DEFAULT');
```

The following statement inserts a new row into the identity_demo table with a provided value for the id column:

```sql
INSERT INTO identity_demo(id,description)
VALUES(2, 'Oracle identity column example with GENERATED BY DEFAULT');
```

The following example attempts to insert a null value into the id column:

```sql
INSERT INTO identity_demo(id,description)
VALUES(NULL,
       'Oracle identity column demo with GENERATED BY DEFAULT, NULL value');
```

Oracle issued an error:

```sql
SQL Error: ORA-01400: cannot insert NULL into ("OT"."IDENTITY_DEMO"."ID")
```

### GENERATED BY DEFAULT ON NULL example

```sql
DROP TABLE identity_demo;

CREATE  TABLE identity_demo  (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    description VARCHAR2(100) not null
  );

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo with no value');
```

### START WITH option example

```sql
DROP TABLE identity_demo;

CREATE  TABLE identity_demo  (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 100,
    description VARCHAR2(100) not null
  );

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo with START WITH option');
```

### INCREMENT BY option example

```sql
DROP TABLE identity_demo;

CREATE  TABLE identity_demo (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 10 INCREMENT BY 10,
    description VARCHAR2(100) not null
);

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo 1 with INCREMENT BY option');

INSERT INTO identity_demo(description)
VALUES('Oracle identity column demo 2 with INCREMENT BY option');
```

### Oracle identity column restrictions

- Each table has one and only one identity column.
- The data type of the identity column must be a numeric data type. the user-defined data type is not allowed to use with the identity clause.
- The identity column is not inherited by the `CREATE TABLE` AS `SELECT` statement.
- The identity column cannot have another `DEFAULT` constraint.
- The encryption algorithm for encrypted identity columns can be inferred therefore you should use a strong encryption algorithm.
- The inline constraint of the identity column must not conflict with the `NOT NULL` and `NOT DEFERRABLE` constraint stated by the identity clause.

## FOREIGN KEY

```sql
CREATE TABLE child_table (
    ...
    CONSTRAINT fk_name
    FOREIGN KEY(col1, col2,...) REFERENCES parent_table(col1,col2)
    ON DELETE [ CASCADE | SET NULL ]
);
```

- First, to explicitly assign the foreign key constraint a name, you use the `CONSTRAINT` clause followed by the name. The `CONSTRAINT` clause is optional. If you omit it, Oracle will assign a system-generated name to the foreign key constraint.

- Second, specify the `FOREIGN KEY` clause to defines one or more column as a foreign key and parent table with columns to which the foreign key columns reference.

Third, use the `ON DELETE` clause to specify consequence when the rows in the parent table are deleted.

- **ON DELETE CASCADE:** if a row in the parent is deleted, then all the rows in the child table that reference the removed row will be deleted.
- **ON DELETE SET NULL:** if a row in the parent is deleted, then all the rows in the child table reference the removed row will be set to NULL for the foreign key columns.

Unlike the primary key constraint, a table may have more than one foreign key constraint.

### Add a foreign key constraint to a table

```sql
ALTER TABLE child_table
ADD CONSTRAINT fk_name
FOREIGN KEY (col1,col2) REFERENCES parent_table(col1,col2);
```

### Drop a foreign key constraint

```sql
ALTER TABLE child_table
DROP CONSTRAINT fk_name;
```

### Disable a foreign key constraint

```sql
ALTER TABLE child_table
DISABLE CONSTRAINT fk_name;
```

### Enable a foreign constraint

```sql
ALTER TABLE child_table
ENABLE CONSTRAINT fk_name;
```

## NOT NULL constraint

```sql
CREATE TABLE table_name (
    ...
    column_name data_type NOT NULL
    ...
);
```

```sql
ALTER TABLE table_name MODIFY ( column_name NOT NULL);
```

### Drop NOT NULL constraints

```sql
ALTER TABLE table_name MODIFY ( column_name NULL)
```

## CHECK constraint

An Oracle check constraint allows you to enforce domain integrity by limiting the values accepted by one or more columns.

### Creating Oracle Check

```sql
CREATE TABLE parts (
    part_id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    part_name VARCHAR2(255) NOT NULL,
    buy_price NUMBER(9,2) CHECK(buy_price > 0),
    PRIMARY KEY(part_id)
);
```

```sql
DROP TABLE parts;

CREATE TABLE parts (
    part_id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    part_name VARCHAR2(255) NOT NULL,
    buy_price NUMBER(9,2) CONSTRAINT check_positive_buy_price CHECK(buy_price > 0),
    PRIMARY KEY(part_id)
);
```

### Add Check constraint to a table

```sql
ALTER TABLE parts
ADD CONSTRAINT check_positive_cost CHECK (cost > 0);
```

### Drop checking constraint

```sql
ALTER TABLE parts
DROP CONSTRAINT check_valid_cost;
```

### Disable / Enable check constraint

```sql
ALTER TABLE table_name
DISABLE CONSTRAINT check_constraint_name;

ALTER TABLE table_name
ENABLE CONSTRAINT check_constraint_name;
```

### Restrictions of Oracle check constraint

- You can define check constraints for tables only, not views.
- The expression of the check constraint can refer to any column in the table, but it cannot refer to columns of other tables.
- The expression also cannot contain one of the following constructs:
- Non-deterministic functions such as SYSDATE, CURRENT_DATE, and CURRENT_TIMESTAMP.
- Subqueries or a scalar subquery expressions.
- Calls to any user-defined functions.
- Nested table columns or attributes.
- The pseudo-columns CURRVAL, NEXTVAL, LEVEL, or ROWNUM.
- Date constants that are not fully specified.

## UNIQUE constraint

A unique constraint is an integrity constraint that ensures the data stored in a column, or a group of columns, is unique among the rows in a table.

```sql
CREATE TABLE table_name (
    ...
    column_name data_type UNIQUE
    ...
);
```

```sql
CREATE TABLE table_name (
    ...,
    UNIQUE(column_name)
);
```

```sql
CREATE TABLE table_name (
    ...
    column_name data_type CONSTRAINT unique_constraint_name UNIQUE
    ...
);
```

```sql
CREATE TABLE table_name (
    ...
    column_name data_type,
    ...,
    CONSTRAINT unique_constraint_name UNIQUE(column_name)
);
```

```sql
CREATE TABLE table_name (
    ...
    column_name1 data_type,
    column_name2 data_type,
    ...,
    CONSTRAINT unique_constraint_name UNIQUE(column_name1, column_name2)
);
```

```sql
ALTER TABLE table_name
ADD CONSTRAINT unique_constraint_name UNIQUE(column_name1, column_nam2);
```

```sql
ALTER TABLE table_name
DISABLE CONSTRAINT unique_constraint_name;
```

```sql
ALTER TABLE table_name
ENABLE CONSTRAINT unique_constraint_name;
```

```sql
ALTER TABLE table_name
DROP CONSTRAINT unique_constraint_name;
```
